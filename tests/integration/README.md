# Integration Tests

This directory contains integration tests that verify the CLI works end-to-end with real fixtures.

## Test Files

### fixtures-integration.test.js
Comprehensive test suite for all DOM Cascade fixtures. Tests:
- CLI build process for all fixtures (builds to `dist/` folder)
- Output comparison with expected results (compares `dist/` vs `output/`)
- Expected content validation (fallback when no expected output exists)
- Specific DOM Cascade features
- Regression prevention

**Usage:**
```bash
# Run all fixture integration tests
bun test tests/integration/fixtures-integration.test.js

# Run with timeout for slow builds
bun test tests/integration/fixtures-integration.test.js --timeout 60000
```

## Adding New Tests

### New Fixture Tests
Add to the `FIXTURES` array in `fixtures-integration.test.js`:

```javascript
{
    name: 'your-fixture-name',
    description: 'What this fixture tests',
    srcDir: 'src', // or 'input' for fixtures using input/output pattern
    expectedContent: [
        'Expected text 1',
        'Expected text 2'
    ],
    absentContent: [
        'Text that should NOT be present'
    ]
}
```

### New Feature Tests
Add to the "DOM Cascade Features" describe block:

```javascript
test('Your feature description', () => {
    const indexPath = join(FIXTURES_DIR, 'fixture-name', 'dist', 'index.html');
    
    if (!existsSync(indexPath)) {
        console.warn('Skipping - fixture not built yet');
        return;
    }
    
    const content = readFileSync(indexPath, 'utf-8');
    
    // Your assertions here
    expect(content.includes('expected content')).toBe(true);
});
```

## Helper Functions

Available for use in tests:
- `buildFixture(path, useInputDir)` - Build a fixture using CLI
- `validateContent(htmlPath, expected, absent)` - Validate HTML content
- `compareWithExpectedOutput(fixturePath, useInputDir)` - Compare dist vs output
- `extractCSSOrder(content)` - Extract CSS file order from HTML

## Test Structure

```
tests/integration/
â”œâ”€â”€ README.md                    # This file
â”œâ”€â”€ fixtures-integration.test.js # Main fixture test suite
â””â”€â”€ [other integration tests]    # Other integration test files
```

### Fixture Structure
Each fixture should have:
```
tests/fixtures/fixture-name/
â”œâ”€â”€ src/                         # Input files (or input/ for some fixtures)
â”‚   â”œâ”€â”€ index.html              # Main page
â”‚   â”œâ”€â”€ _includes/              # Layouts and components
â”‚   â””â”€â”€ [other files]
â”œâ”€â”€ output/                      # Expected output files
â”‚   â””â”€â”€ index.html              # Expected result
â””â”€â”€ dist/                        # Generated by tests (cleaned up after)
    â””â”€â”€ index.html              # CLI output for comparison
```

## Debugging Tips

1. **Build failures**: Check CLI output for specific error messages
2. **Content validation failures**: Check console output for content preview
3. **Missing files**: Verify fixture structure and build success
4. **Flaky tests**: Tests clean up after themselves, but check for race conditions

## Implementation Status

The tests document current DOM Cascade implementation status:
- âœ… Fully working features have passing tests
- âš ï¸ Partially implemented features have commented expectations
- ğŸš§ Future features can be added as fixtures are created